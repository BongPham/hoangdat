(function(){"use strict";function e(e){for(var t=e+"=",r=document.cookie.split(";"),a=0;a<r.length;a++){for(var n=r[a];" "==n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(t))return n.substring(t.length,n.length)}return null}function t(e,t,a){var n=new Date,i=e?31536e6:252e5;r(t,a,n.getTime()+i)}function r(e,t,r){var a=new Date(r);document.cookie=e+"="+escape(t)+";path=/;expires="+a.toUTCString()}function a(e){for(var t=e.split("&"),r=0;r<t.length;r++){var a=t[r].split("=");if("quantity"===a[0])return parseInt(a[1])}return 1}function n(){var e=window.location.href,t=e.indexOf("?");return e=-1===t?"":e.slice(t),t=e.indexOf("#"),e=-1===t?e:e.slice(0,t),e="?"===e?"":e,{path:window.location.pathname,referrer:document.referrer,search:e,title:document.title,url:o(),properties:{}}}function i(){for(var e=document.getElementsByTagName("link"),t=0;t<e.length;t++){var r=e[t];if("canonical"===r.getAttribute("rel"))return r.getAttribute("href")}return""}function o(){var e=i();if(e)return e.indexOf("?")>0?e:e+window.location.search;var t=window.location.href,r=t.indexOf("#");return-1===r?t:t.slice(0,r)}var c={pageType:"",products:[],properties:{arrProductId:"",id:"",variantId:"",name:"",variant:"",category:"",quantity:1,price:0,sku:"",vendor:"",type:"",keySearch:"",coupon:"",orderId:"",shipping:0,subtotal_price:0,total_price:0,cartToken:!1,event:"Action not defined",currency:HaravanAnalytics.meta.currency},options_GA:{anonymizeIp:!1,doubleClick:!0,enhancedEcommerceLoaded:!1,enhancedEcommerce:HaravanAnalytics.enhancedEcommerce||!1,enhancedLinkAttribution:!1,includeSearch:!0,nonInteraction:!1}};HaravanAnalytics.init=function(){this.registerOnload(function(e){try{HaravanAnalytics.ga&&HaravanAnalytics.ga_eventOnload(e),HaravanAnalytics.fb&&HaravanAnalytics.fb_eventOnload(e)}catch(e){}}),this.registerFormSubmit(function(e){try{HaravanAnalytics.ga&&HaravanAnalytics.ga_eventFormSubmit(e),HaravanAnalytics.fb&&HaravanAnalytics.fb_eventFormSubmit(e)}catch(e){}}),document.addEventListener("DOMContentLoaded",function(e){HaravanAnalytics.registerAjax(function(e){try{HaravanAnalytics.ga&&HaravanAnalytics.ga_eventAjax(e),HaravanAnalytics.fb&&HaravanAnalytics.fb_eventAjax(e)}catch(e){}})})},HaravanAnalytics.registerOnload=function(r){var a=HaravanAnalytics.meta.page.pageType;if(a){if(c.pageType=a,"product"==a){var n=HaravanAnalytics.meta.product;n&&(c.properties.id=n.id,n.selected_or_first_available_variant?(c.properties.name=n.selected_or_first_available_variant.title,c.properties.variantId=n.selected_or_first_available_variant.id,c.properties.variant=n.selected_or_first_available_variant.variant_title,c.properties.price=n.selected_or_first_available_variant.price/100,c.properties.sku=n.selected_or_first_available_variant.sku):(c.properties.title=n.title,c.properties.price=n.price/100),c.properties.vendor=n.vendor,c.properties.type=n.type,c.properties.event="Viewed Product")}else if("searchresults"==a){var i=HaravanAnalytics.meta.search;i&&(c.properties.keySearch=i.query)}else if("thankyou"==a){if(!Haravan.checkout)return;var o=Haravan.checkout,p=[],s=0;$.each(o.line_items,function(e,t){var r={id:t.product_id,variantId:t.variant_id,name:t.title,variant:t.variant_title,category:"",quantity:t.quantity,price:t.price,sku:t.sku,vendor:t.vendor,type:"",currency:HaravanAnalytics.meta.currency};c.products.push(r),0==p.includes(t.product_id)&&p.push(t.product_id),s+=t.quantity}),c.properties.arrProductId=p,c.properties.coupon=o.discount.code,c.properties.orderId=o.order_number,c.properties.shipping=o.shipping_rate.price,c.properties.subtotal_price=o.subtotal_price,c.properties.total_price=o.total_price,c.properties.quantity=s,c.properties.event="Completed Order",e("tracked_start_checkout")==o.token?t(!0,"tracked_start_checkout",""):c.properties.cartToken=!0}else if("checkout"==a){var u=HaravanAnalytics.meta.cart,d=HaravanAnalytics.meta.page;if(u&&d){var p=[];$.each(u.products,function(e,t){var r={id:t.productId,variantId:t.variantId,name:t.name,variant:t.variant,category:"",quantity:t.quantity,price:t.price,sku:t.sku,vendor:t.vendor,type:t.type,currency:HaravanAnalytics.meta.currency};c.products.push(r),0==p.includes(t.productId)&&p.push(t.productId)}),c.properties.arrProductId=p,c.properties.quantity=u.item_count,c.properties.total_price=u.total_price/100,c.properties.event="Viewed Checkout",e("tracked_start_checkout")!=d.resourceId||""==e("tracked_start_checkout")||null==e("tracked_start_checkout")||"undefined"==e("tracked_start_checkout")?t(!0,"tracked_start_checkout",d.resourceId):c.properties.cartToken=!0}}r(c)}},HaravanAnalytics.registerFormSubmit=function(e){function t(e,t,r){e.addEventListener?e.addEventListener(t,r):e.attachEvent&&e.attachEvent("on"+t,r)}function r(t){t=t||window.event;var r=t.target||t.srcElement;r&&(r.getAttribute("action")||r.getAttribute("href"))&&e(a)}var a={};t(window,"load",function(){for(var e=0;e<document.forms.length;e++){var a=document.forms[e].getAttribute("action");a&&a.indexOf("/cart")>=0&&t(document.forms[e],"submit",r)}for(var e=0;e<document.links.length;e++){var n=document.links[e].getAttribute("href");n&&n.indexOf("/checkout")>=0&&t(document.links[e],"click",r)}})},HaravanAnalytics.registerAjax=function(e){window.jQuery&&$(document).ajaxSuccess(function(t,r,n){if(void 0!=n&&n.url.indexOf("/cart/add")!=-1&&void 0!=r&&r.responseJSON){var i=r.responseJSON,o="",p=a(n.data);$.each(i.variant_options,function(e,t){o=o+t+" / "}),c.pageType="ajaxCart";var s=c.properties;s.id=i.product_id,s.variantId=i.variant_id,s.name=i.title+" - "+o.slice(0,-3),s.variant=o.slice(0,-3),s.category="",s.quantity=p,s.price=i.price/100,s.sku=i.sku,s.vendor=i.vendor,s.type="",s.event="Added Product",e(c),c.options_GA.enhancedEcommerce&&HaravanAnalytics.enhancedEcommerce(c)}})},HaravanAnalytics.ga_eventOnload=function(e){e&&e.options_GA.enhancedEcommerce&&(e.options_GA.doubleClick&&window.ga("require","displayfeatures"),HaravanAnalytics.ga_pageView(e,n()),e.options_GA.enhancedLinkAttribution&&window.ga("require","linkid"),e.options_GA.anonymizeIp&&window.ga("set","anonymizeIp",e.options_GA.anonymizeIp),e.options_GA.enhancedEcommerce&&HaravanAnalytics.enhancedEcommerce(e))},HaravanAnalytics.ga_eventFormSubmit=function(e){e&&ga(function(e){var t=e.get("linkerParam");document.cookie="_haravan_ga="+t+"; path=/"})},HaravanAnalytics.ga_eventAjax=function(e){},HaravanAnalytics.ga_pageView=function(e,t){var r=t.path,a=e.options_GA.includeSearch&&t.search&&(r+=t.search)||r,n=t.title,i={page:a,title:n};window.ga("set",i);var o={page:a,title:n,location:t.url};window.ga("send","pageview",o)},HaravanAnalytics.enhancedEcommerce=function(e){function t(e){var t=e.options_GA;t.enhancedEcommerceLoaded||(window.ga("require","ec"),t.enhancedEcommerceLoaded=!0),window.ga("set","&cu",e.properties.currency)}function r(e){var t=e.properties,r={eventAction:t.event,eventCategory:t.category||"All",eventLabel:t.label,eventValue:t.total_price.toString(),nonInteraction:!0};window.ga("send","event",r)}function a(e){var t={id:e.sku||e.variantId.toString()||e.id.toString(),name:e.name,category:"",quantity:e.quantity,price:e.price.toString(),vendor:e.vendor,variant:e.variant,currency:e.currency};e.coupon&&(t.coupon=e.coupon),window.ga("ec:addProduct",t)}function n(e){var t=e.properties;window.ga("send","event",{eventCategory:t.category||"EnhancedEcommerce",eventAction:t.event,eventLabel:t.label,nonInteraction:!0})}function i(e,t){a(e),window.ga("ec:setAction",t)}function o(e){var r=e.properties;t(e),i(r,"detail"),n(e)}function c(e){var r=e.properties;t(e),i(r,"add"),n(e)}function p(e){var r=e.products;t(e);for(var i=0;i<e.products.length;i++)a(r[i]);window.ga("ec:setAction","checkout",{step:1}),n(e)}function s(e){var r=e.properties,i=r.total_price.toString()||r.subtotal_price.toString()||"",o=r.orderId.toString(),c=e.products||[];if(o){t(e);for(var p=0;p<c.length;p++)a(c[p]);window.ga("ec:setAction","purchase",{id:o,affiliation:void 0,revenue:i,tax:"",shipping:r.shipping.toString(),coupon:r.coupon}),n(e)}}"product"==e.pageType?o(e):"ajaxCart"==e.pageType?c(e):"checkout"==e.pageType?e.properties.cartToken?r(e,"Viewed Checkout - Contact information Page"):p(e):"thankyou"==e.pageType&&(e.properties.cartToken?r(e,"Viewed Orders - Thank You Page"):s(e))},HaravanAnalytics.fb_eventOnload=function(e){e&&("product"==e.pageType?fbq("track","ViewContent",{content_ids:[e.properties.id],content_name:e.properties.name,content_type:"product_group",value:e.properties.price,currency:e.properties.currency}):"searchresults"==e.pageType?fbq("track","Search",{search_string:e.properties.keySearch}):"thankyou"==e.pageType?(fbq("track","AddPaymentInfo",{value:e.properties.total_price,currency:e.properties.currency}),fbq("track","Purchase",{content_ids:e.properties.arrProductId,content_type:"product_group",value:e.properties.subtotal_price,num_items:e.properties.quantity,currency:e.properties.currency})):"checkout"!=e.pageType||e.properties.cartToken||fbq("track","InitiateCheckout",{content_ids:e.properties.arrProductId,content_type:"product_group",value:e.properties.total_price,num_items:e.properties.quantity,currency:e.properties.currency}))},HaravanAnalytics.fb_eventFormSubmit=function(e){},HaravanAnalytics.fb_eventAjax=function(e){e&&fbq("track","AddToCart",{content_ids:[e.properties.id],content_name:e.properties.name,content_type:"product_group",value:e.properties.price,num_items:e.properties.quantity,currency:e.properties.currency})};try{HaravanAnalytics.init()}catch(e){}})();